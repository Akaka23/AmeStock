{% extends "base.html" %}

{% load static %}
{% load watermark %}
{% block title %}Checkout|{{ block.super }}{% endblock %}


{% block head %}
{% if not object.product.requires_shipping %}
<style>
    .shipping-address-class {
        display: none !important;
    }
</style>
{% endif %}

{% endblock %}


{% block content %}

<!-- Breadcrumb Begin -->
<div class="breadcrumb-option spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 ">
                <div class="bo-links">
                    
                    <a href="/">
                        <img src="{% static 'img/logo.png' %}" alt="">
                    </a>
                
                    <!-- <a href="."><i class="fa fa-home"></i> Home</a> -->
                    <span style="float: right;">Secured Checkout</span>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Breadcrumb End -->

<section class="mb-4">
    <div class="container">
        <div class="row">
            <div class="col-lg-5 order-md-2">


                <table class="table table-borderless border-bottom">
                    <tr>
                        <td>{{object.product}}</td>
                        <td>${{ object.subtotal }}</td>
                    </tr>
                    <tr>

                        <td>Tax</td>

                        <td>${{ object.tax }}</td>
                    </tr>
                    <tr class="font-weight-bold">
                        <td class="">Total</td>

                        <td>${{ object.total }}</td>
                    </tr>
                </table>
                <div id="paypal-button-container"></div>

            </div>
            <div class="col-lg-7">


                <div class="border-right">
                    <img class="img-fluid" src="{{object.product.image.url|watermark:'MeShutter,position=C,opacity=85'}}" width="500px" alt="">
                    <span>
                        <small>
                            {{ object.product.content }} <br>
                            Image Size: {{ object.product.image_size }} <br>
                            Location:{{ object.product.location }} <br>
                        </small>
                    </span>
                </div>



            </div>
        </div>

    </div>


    <!-- Include the PayPal JavaScript SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=AYB4TeDYPh327SQvBcgshWcGXP1tnBEuZSODj5ZXHNRHxHMpvA9vIk8c-nVhRGJSA-ZFlyXhsTJlAUtI&currency=USD&disable-funding=card,credit"></script>


    <script>
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        // Render the PayPal button into #paypal-button-container
        paypal.Buttons({
            style: {
                color: 'blue',
                shape: 'pill',
                label: 'pay',
                height: 40,
            },
            // Set up the transaction
            createOrder: function (data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: '{{ object.total }}'
                        }
                    }]
                });
            },

            // Finalize the transaction
            onApprove: function (data, actions) {
                return actions.order.capture().then(function (orderData) {
                    var url = '{% url "order:payment" %}'
                    return fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-type': 'application/json',
                            'X-CSRFToken': getCookie('csrftoken'),
                        },
                        body: JSON.stringify({
                            orderID: 'Capture result'.orderID
                        })
                    }).then(function () {
                        location.href = '{% url "order:success" %}';
                    })
                });
            }


        }).render('#paypal-button-container');
    </script>

    {% endblock %}